<!-- üìÖ CONTENEDOR PRINCIPAL -->
<div class="agenda-area-container">

    <!-- üóìÔ∏è HEADER CON NAVEGACI√ìN DE SEMANAS -->
    <nz-card class="week-navigation-card">
        <div class="week-header">
            <!-- Navegaci√≥n seg√∫n el tipo de vista -->
            <div class="week-navigation">
                <!-- VISTA DIARIA -->
                <ng-container *ngIf="viewMode === 'daily'">
                    <button nz-button nzType="default" (click)="goToPreviousDay()">
                        <i nz-icon nzType="left"></i>
                        Anterior
                    </button>
                    <button nz-button nzType="default" (click)="goToToday()">
                        <i nz-icon nzType="calendar"></i>
                        Hoy
                    </button>
                    <button nz-button nzType="default" (click)="goToNextDay()">
                        Siguiente
                        <i nz-icon nzType="right"></i>
                    </button>
                </ng-container>

                <!-- VISTA SEMANAL -->
                <ng-container *ngIf="viewMode === 'weekly'">
                    <button nz-button nzType="default" (click)="goToPreviousWeek()">
                        <i nz-icon nzType="left"></i>
                        Anterior
                    </button>
                    <button nz-button nzType="default" (click)="goToCurrentWeek()">
                        <i nz-icon nzType="calendar"></i>
                        Hoy
                    </button>
                    <button nz-button nzType="default" (click)="goToNextWeek()">
                        Siguiente
                        <i nz-icon nzType="right"></i>
                    </button>
                </ng-container>

                <!-- VISTA MENSUAL -->
                <ng-container *ngIf="viewMode === 'monthly'">
                    <button nz-button nzType="default" (click)="goToPreviousMonth()">
                        <i nz-icon nzType="left"></i>
                        Mes Anterior
                    </button>
                    <button nz-button nzType="default" (click)="goToCurrentMonth()">
                        <i nz-icon nzType="calendar"></i>
                        Este Mes
                    </button>
                    <button nz-button nzType="default" (click)="goToNextMonth()">
                        Mes Siguiente
                        <i nz-icon nzType="right"></i>
                    </button>
                </ng-container>
            </div>

            <!-- T√≠tulo seg√∫n el tipo de vista -->
            <div class="week-title">
                <h3 *ngIf="viewMode === 'daily'">{{ selectedDate | date:'dd/MM/yyyy' }}</h3>
                <h3 *ngIf="viewMode === 'weekly'">{{ currentWeekStart | date:'dd/MM/yyyy' }} - {{ currentWeek[4] |
                    date:'dd/MM/yyyy' }}</h3>
                <h3 *ngIf="viewMode === 'monthly'">{{ currentMonthDate | date:'MMMM yyyy' }}</h3>
                <span class="week-subtitle">Agenda de {{ area | uppercase }}</span>
            </div>

            <!-- Botones de cambio de vista y crear actividad -->
            <div class="week-actions">
                <!-- Grupo de botones de vista -->
                <div class="button-group">
                    <button nz-button [nzType]="viewMode === 'daily' ? 'primary' : 'default'" nz-tooltip
                        nzTooltipTitle="Vista Diaria" (click)="setViewMode('daily')">
                        <i nz-icon nzType="calendar" nzTheme="outline"></i>
                        D√≠a
                    </button>
                    <button nz-button [nzType]="viewMode === 'weekly' ? 'primary' : 'default'" nz-tooltip
                        nzTooltipTitle="Vista Semanal" (click)="setViewMode('weekly')">
                        <i nz-icon nzType="calendar" nzTheme="outline"></i>
                        Semana
                    </button>
                    <button nz-button [nzType]="viewMode === 'monthly' ? 'primary' : 'default'" nz-tooltip
                        nzTooltipTitle="Vista Mensual" (click)="setViewMode('monthly')">
                        <i nz-icon nzType="calendar" nzTheme="outline"></i>
                        Mes
                    </button>
                </div>

                <button nz-button nzType="primary" (click)="openCreateModal()">
                    <i nz-icon nzType="plus"></i>
                    Nueva Actividad
                </button>
            </div>
        </div>
    </nz-card>

    <!-- üîç Barra de B√∫squeda Separada -->
    <div class="search-bar-section">
        <nz-card [nzBodyStyle]="{ padding: '12px 16px' }">
            <div class="search-input-wrapper">
                <nz-input-group [nzPrefix]="prefixIconSearch" [nzSuffix]="suffixSearchActions" nzSize="large">
                    <input type="text" nz-input
                        placeholder="Buscar actividades... (presiona Enter o click en Buscar)"
                        [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange($event)"
                        (keyup.enter)="executeSearch()" />
                </nz-input-group>

                <button nz-button nzType="primary" nzSize="large"
                    [disabled]="!searchTerm || searchTerm.trim().length === 0" (click)="executeSearch()"
                    class="search-button">
                    <i nz-icon nzType="search" nzTheme="outline"></i>
                    Buscar
                </button>
            </div>

            <ng-template #prefixIconSearch>
                <i nz-icon nzType="search"></i>
            </ng-template>

            <ng-template #suffixSearchActions>
                <div class="search-suffix">
                    <i *ngIf="searchTerm" nz-icon nzType="close-circle" nzTheme="fill" class="search-clear-icon"
                        (click)="clearSearch()" nz-tooltip nzTooltipTitle="Limpiar b√∫squeda"></i>
                </div>
            </ng-template>
        </nz-card>
    </div>

    <!-- üóìÔ∏è CALENDARIO SEMANAL/MENSUAL/DIARIO -->
    <nz-spin [nzSpinning]="isLoading" nzTip="Cargando actividades...">
        <div class="calendar-container">

            <!-- ========== VISTA DIARIA ========== -->
            <div *ngIf="viewMode === 'daily'" class="daily-view">
                <nz-row [nzGutter]="16">
                    <nz-col [nzSpan]="24">
                        <nz-card class="day-card today-card" [nzBodyStyle]="{ padding: '12px' }">

                            <div class="day-header">
                                <div>
                                    <div class="day-name">{{ getDayName(selectedDate) }}</div>
                                    <div class="day-number today-number">
                                        {{ selectedDate | date:'d' }}
                                    </div>
                                </div>
                                <div class="day-count">
                                    <nz-badge [nzCount]="getDisplayActivities(getDateKey(selectedDate))?.length || 0"
                                        [nzShowZero]="true">
                                    </nz-badge>
                                </div>
                            </div>

                            <!-- Contenedor de actividades -->
                            <div cdkDropList [id]="'drop-' + getDateKey(selectedDate)"
                                [cdkDropListData]="getDisplayActivities(getDateKey(selectedDate)) || []"
                                (cdkDropListDropped)="onDrop($event, selectedDate)"
                                class="activities-container activities-container-large">

                                <div *ngIf="!getDisplayActivities(getDateKey(selectedDate))?.length" class="empty-day">
                                    <div class="empty-message">
                                        <i nz-icon nzType="inbox" nzTheme="outline"></i>
                                        <span>No hay actividades para este d√≠a</span>
                                    </div>
                                </div>

                                <!-- Lista de actividades (mismo c√≥digo que la vista semanal) -->
                                <div *ngFor="let activity of getDisplayActivities(getDateKey(selectedDate)); trackBy: trackByActivityId"
                                    cdkDrag class="activity-item"
                                    [class.activity-pendiente]="activity.estado === 'pendiente'"
                                    [class.activity-en_progreso]="activity.estado === 'en_progreso'"
                                    [class.activity-completada]="activity.estado === 'completada'"
                                    [class.activity-pospuesta]="activity.estado === 'pospuesta'">

                                    <nz-card [nzBodyStyle]="{ padding: '8px' }" class="activity-card"
                                        (click)="viewActivityDetails(activity)">

                                        <div class="drag-handle" cdkDragHandle>
                                            <i nz-icon nzType="drag" nzTheme="outline"></i>
                                        </div>

                                        <div class="activity-header">
                                            <nz-tag [nzColor]="getPriorityColor(activity.prioridad)" style="margin: 0;">
                                                {{ activity.prioridad | uppercase }}
                                            </nz-tag>
                                            <nz-tag [nzColor]="getActivityStatusColor(activity.estado)"
                                                style="margin: 0;">
                                                {{ activity.estado }}
                                            </nz-tag>
                                        </div>

                                        <div class="activity-content">
                                            <div class="activity-title">{{ activity.titulo }}</div>
                                            <div class="activity-description" *ngIf="activity.descripcion">
                                                {{ activity.descripcion }}
                                            </div>
                                            <div class="activity-responsible">
                                                <i nz-icon nzType="user" nzTheme="outline"></i>
                                                {{ activity.responsableNombre }}
                                            </div>
                                        </div>

                                        <div class="activity-actions">
                                            <button nz-button nzType="text" nzSize="small" nz-tooltip
                                                nzTooltipTitle="Editar"
                                                (click)="$event.stopPropagation(); editActivity(activity)">
                                                <i nz-icon nzType="edit" nzTheme="outline"></i>
                                            </button>

                                            <button nz-button nzType="text" nzSize="small" nz-tooltip
                                                nzTooltipTitle="Completar" *ngIf="activity.estado !== 'completada'"
                                                (click)="$event.stopPropagation(); completeActivity(activity)">
                                                <i nz-icon nzType="check-circle" nzTheme="outline"></i>
                                            </button>

                                            <button nz-button nzType="text" nzSize="small" nzDanger nz-tooltip
                                                nzTooltipTitle="Eliminar" nz-popconfirm
                                                nzPopconfirmTitle="¬øEliminar esta actividad?" nzOkText="S√≠"
                                                (click)="$event.stopPropagation()" nzCancelText="No"
                                                (nzOnConfirm)="deleteActivity(activity)">
                                                <i nz-icon nzType="delete" nzTheme="outline"></i>
                                            </button>
                                        </div>
                                    </nz-card>

                                    <div *cdkDragPlaceholder class="cdk-drag-placeholder">
                                        Soltando aqu√≠...
                                    </div>
                                </div>
                            </div>
                        </nz-card>
                    </nz-col>
                </nz-row>
            </div>

            <!-- ========== VISTA SEMANAL (ACTUAL) ========== -->
            <div *ngIf="viewMode === 'weekly'">
                <nz-row [nzGutter]="16" class="calendar-week">

                    <!-- üìÖ COLUMNA POR CADA D√çA -->
                    <nz-col [nzXs]="24" [nzSm]="24" [nzMd]="12" [nzLg]="12" [nzXl]="{ span: 24 / 7 }"
                        *ngFor="let date of currentWeek; trackBy: trackByDate" class="calendar-day-col">

                        <nz-card class="day-card" [nzBodyStyle]="{ padding: '12px' }"
                            [class.today-card]="isToday(date)">

                            <!-- üìÖ HEADER DEL D√çA -->
                            <div class="day-header">
                                <div>
                                    <div class="day-name">{{ getDayName(date) }}</div>
                                    <div class="day-number" [class.today-number]="isToday(date)">
                                        {{ date | date:'d' }}
                                    </div>
                                </div>
                                <div class="day-count">
                                    <nz-badge [nzCount]="getDisplayActivities(getDateKey(date))?.length || 0"
                                        [nzShowZero]="true">
                                    </nz-badge>
                                </div>
                            </div>

                            <!-- üéØ CONTENEDOR DE ACTIVIDADES CON DRAG & DROP -->
                            <div cdkDropList [id]="'drop-' + getDateKey(date)"
                                [cdkDropListData]="getDisplayActivities(getDateKey(date)) || []"
                                [cdkDropListConnectedTo]="getConnectedLists()"
                                (cdkDropListDropped)="onDrop($event, date)" class="activities-container">

                                <!-- üì≠ ESTADO VAC√çO -->
                                <div *ngIf="!getDisplayActivities(getDateKey(date))?.length" class="empty-day">
                                    <div class="empty-message">
                                        <i nz-icon nzType="inbox" nzTheme="outline"></i>
                                        <span>Arrastra actividades aqu√≠</span>
                                    </div>
                                </div>

                                <!-- üé¥ LISTA DE ACTIVIDADES -->
                                <div *ngFor="let activity of getDisplayActivities(getDateKey(date)); trackBy: trackByActivityId"
                                    cdkDrag class="activity-item"
                                    [class.activity-pendiente]="activity.estado === 'pendiente'"
                                    [class.activity-en_progreso]="activity.estado === 'en_progreso'"
                                    [class.activity-completada]="activity.estado === 'completada'"
                                    [class.activity-pospuesta]="activity.estado === 'pospuesta'">

                                    <nz-card [nzBodyStyle]="{ padding: '8px' }" class="activity-card"
                                        (click)="viewActivityDetails(activity)">

                                        <!-- üéØ DRAG HANDLE -->
                                        <div class="drag-handle" cdkDragHandle>
                                            <i nz-icon nzType="drag" nzTheme="outline"></i>
                                        </div>

                                        <!-- üè∑Ô∏è HEADER -->
                                        <div class="activity-header">
                                            <nz-tag [nzColor]="getPriorityColor(activity.prioridad)" style="margin: 0;">
                                                {{ activity.prioridad | uppercase }}
                                            </nz-tag>
                                            <nz-tag [nzColor]="getActivityStatusColor(activity.estado)"
                                                style="margin: 0;">
                                                {{ activity.estado }}
                                            </nz-tag>
                                        </div>

                                        <!-- üìù CONTENIDO -->
                                        <div class="activity-content">
                                            <div class="activity-title">{{ activity.titulo }}</div>
                                            <div class="activity-description" *ngIf="activity.descripcion">
                                                {{ activity.descripcion }}
                                            </div>
                                            <div class="activity-responsible">
                                                <i nz-icon nzType="user" nzTheme="outline"></i>
                                                {{ activity.responsableNombre }}
                                            </div>
                                        </div>

                                        <!-- ‚ö° ACCIONES -->
                                        <div class="activity-actions">
                                            <button nz-button nzType="text" nzSize="small" nz-tooltip
                                                nzTooltipTitle="Editar"
                                                (click)="$event.stopPropagation(); editActivity(activity)">
                                                <i nz-icon nzType="edit" nzTheme="outline"></i>
                                            </button>

                                            <button nz-button nzType="text" nzSize="small" nz-tooltip
                                                nzTooltipTitle="Completar" *ngIf="activity.estado !== 'completada'"
                                                (click)="$event.stopPropagation(); completeActivity(activity)">
                                                <i nz-icon nzType="check-circle" nzTheme="outline"></i>
                                            </button>

                                            <button nz-button nzType="text" nzSize="small" nzDanger nz-tooltip
                                                nzTooltipTitle="Eliminar" nz-popconfirm
                                                nzPopconfirmTitle="¬øEliminar esta actividad?" nzOkText="S√≠"
                                                (click)="$event.stopPropagation()" nzCancelText="No"
                                                (nzOnConfirm)="deleteActivity(activity)">
                                                <i nz-icon nzType="delete" nzTheme="outline"></i>
                                            </button>
                                        </div>
                                    </nz-card>

                                    <!-- üéØ PLACEHOLDER PARA DRAG -->
                                    <div *cdkDragPlaceholder class="cdk-drag-placeholder">
                                        Soltando aqu√≠...
                                    </div>
                                </div>
                            </div>
                        </nz-card>
                    </nz-col>
                </nz-row>
            </div>

            <!-- ========== VISTA MENSUAL ========== -->
            <div *ngIf="viewMode === 'monthly'" class="monthly-view">
                <div class="month-calendar">
                    <!-- Header de d√≠as de la semana -->
                    <div class="month-header">
                        <div class="month-day-header">LUN</div>
                        <div class="month-day-header">MAR</div>
                        <div class="month-day-header">MI√â</div>
                        <div class="month-day-header">JUE</div>
                        <div class="month-day-header">VIE</div>
                    </div>

                    <!-- Semanas del mes -->
                    <div class="month-week" *ngFor="let week of currentMonth; trackBy: trackByWeek">
                        <div class="month-day-cell" *ngFor="let day of week; trackBy: trackByDate"
                            [class.today]="isToday(day)" [class.other-month]="!isCurrentMonth(day)"
                            (click)="selectDayInMonth(day)">

                            <div class="month-day-number">{{ day | date:'d' }}</div>

                            <!-- Indicador de actividades -->
                            <div class="month-day-activities" *ngIf="getActivityCount(day) > 0">
                                <nz-badge [nzCount]="getActivityCount(day)" [nzStyle]="{ backgroundColor: '#1890ff' }">
                                </nz-badge>
                            </div>

                            <!-- Mini preview de actividades -->
                            <div class="month-activities-preview">
                                <div class="month-activity-dot"
                                    *ngFor="let activity of (monthActivities[getDateKey(day)] || []).slice(0, 3)"
                                    [class.dot-pendiente]="activity.estado === 'pendiente'"
                                    [class.dot-en_progreso]="activity.estado === 'en_progreso'"
                                    [class.dot-completada]="activity.estado === 'completada'"
                                    [class.dot-pospuesta]="activity.estado === 'pospuesta'"
                                    [nz-tooltip]="activity.titulo">
                                </div>
                                <span class="month-more-activities" *ngIf="getActivityCount(day) > 3">
                                    +{{ getActivityCount(day) - 3 }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </nz-spin>
</div>

<!-- üé≠ MODAL CREAR ACTIVIDAD -->
<nz-modal [(nzVisible)]="showCreateModal" nzTitle="Nueva Actividad" nzWidth="600px" (nzOnCancel)="closeCreateModal()"
    (nzOnOk)="createActivity()">

    <ng-container *nzModalContent>
        <form nz-form [formGroup]="createForm" nzLayout="vertical">

            <nz-form-item>
                <nz-form-label nzRequired>T√≠tulo</nz-form-label>
                <nz-form-control nzErrorTip="Por favor ingresa un t√≠tulo">
                    <input nz-input formControlName="titulo" placeholder="T√≠tulo de la actividad" />
                </nz-form-control>
            </nz-form-item>

            <nz-form-item>
                <nz-form-label>Descripci√≥n</nz-form-label>
                <nz-form-control>
                    <textarea nz-input formControlName="descripcion" placeholder="Descripci√≥n detallada"
                        [nzAutosize]="{ minRows: 3, maxRows: 6 }">
          </textarea>
                </nz-form-control>
            </nz-form-item>

            <nz-form-item>
                <nz-form-label nzRequired>
                    Fecha l√≠mite
                    <nz-tooltip
                        nzTooltipTitle="La actividad aparecer√° en esta fecha del calendario y debe completarse ese d√≠a">
                        <i nz-icon nzType="question-circle" nzTheme="outline"
                            style="margin-left: 4px; color: #8c8c8c;"></i>
                    </nz-tooltip>
                </nz-form-label>
                <nz-form-control nzExtra="La tarea aparecer√° en esta fecha del calendario">
                    <nz-date-picker formControlName="fechaLimite" nzFormat="dd/MM/yyyy"
                        nzPlaceHolder="Selecciona la fecha de vencimiento" style="width: 100%;">
                    </nz-date-picker>
                </nz-form-control>
            </nz-form-item>

            <nz-form-item>
                <nz-form-label nzRequired>Prioridad</nz-form-label>
                <nz-form-control>
                    <nz-select formControlName="prioridad">
                        <nz-option nzValue="baja" nzLabel="Baja"></nz-option>
                        <nz-option nzValue="media" nzLabel="Media"></nz-option>
                        <nz-option nzValue="alta" nzLabel="Alta"></nz-option>
                    </nz-select>
                </nz-form-control>
            </nz-form-item>
        </form>
    </ng-container>

    <div *nzModalFooter>
        <button nz-button nzType="default" (click)="closeCreateModal()">Cancelar</button>
        <button nz-button nzType="primary" (click)="createActivity()" [nzLoading]="isLoading">
            Crear
        </button>
    </div>
</nz-modal>

<!-- üé≠ MODAL EDITAR ACTIVIDAD -->
<nz-modal [(nzVisible)]="showEditModal" nzTitle="Editar Actividad" nzWidth="600px" (nzOnCancel)="closeEditModal()"
    (nzOnOk)="saveEditActivity()">

    <ng-container *nzModalContent>
        <form nz-form [formGroup]="editForm" nzLayout="vertical">

            <nz-form-item>
                <nz-form-label nzRequired>T√≠tulo</nz-form-label>
                <nz-form-control nzErrorTip="Por favor ingresa un t√≠tulo">
                    <input nz-input formControlName="titulo" />
                </nz-form-control>
            </nz-form-item>

            <nz-form-item>
                <nz-form-label>Descripci√≥n</nz-form-label>
                <nz-form-control>
                    <textarea nz-input formControlName="descripcion"
                        [nzAutosize]="{ minRows: 3, maxRows: 6 }"></textarea>
                </nz-form-control>
            </nz-form-item>

            <nz-form-item>
                <nz-form-label nzRequired>Fecha l√≠mite</nz-form-label>
                <nz-form-control>
                    <nz-date-picker formControlName="fechaLimite" nzFormat="dd/MM/yyyy" style="width: 100%;">
                    </nz-date-picker>
                </nz-form-control>
            </nz-form-item>

            <nz-form-item>
                <nz-form-label nzRequired>Estado</nz-form-label>
                <nz-form-control>
                    <nz-select formControlName="estado">
                        <nz-option nzValue="pendiente" nzLabel="Pendiente"></nz-option>
                        <nz-option nzValue="en_progreso" nzLabel="En Progreso"></nz-option>
                        <nz-option nzValue="completada" nzLabel="Completada"></nz-option>
                        <nz-option nzValue="pospuesta" nzLabel="Pospuesta"></nz-option>
                    </nz-select>
                </nz-form-control>
            </nz-form-item>

            <nz-form-item>
                <nz-form-label nzRequired>Prioridad</nz-form-label>
                <nz-form-control>
                    <nz-select formControlName="prioridad">
                        <nz-option nzValue="baja" nzLabel="Baja"></nz-option>
                        <nz-option nzValue="media" nzLabel="Media"></nz-option>
                        <nz-option nzValue="alta" nzLabel="Alta"></nz-option>
                    </nz-select>
                </nz-form-control>
            </nz-form-item>

            <nz-form-item>
                <nz-form-label>Notas</nz-form-label>
                <nz-form-control>
                    <textarea nz-input formControlName="notas" placeholder="Notas adicionales"
                        [nzAutosize]="{ minRows: 2, maxRows: 4 }"></textarea>
                </nz-form-control>
            </nz-form-item>
        </form>
    </ng-container>

    <div *nzModalFooter>
        <button nz-button nzType="default" (click)="closeEditModal()">Cancelar</button>
        <button nz-button nzType="primary" (click)="saveEditActivity()" [nzLoading]="isLoading">
            Guardar
        </button>
    </div>
</nz-modal>

<!-- üé≠ MODAL VER DETALLES DE ACTIVIDAD -->
<nz-modal [(nzVisible)]="showViewModal" nzTitle="Ver Detalles de Actividad" nzWidth="700px"
    (nzOnCancel)="closeViewModal()" [nzFooter]="viewModalFooter" nzCentered>

    <ng-container *nzModalContent>
        <div class="view-modal-content" *ngIf="selectedActivity">

            <!-- Encabezado con t√≠tulo y badges -->
            <div class="view-header">
                <h2 class="view-title">{{ selectedActivity.titulo }}</h2>
                <div class="view-badges">
                    <nz-tag [nzColor]="getPriorityColor(selectedActivity.prioridad)" class="view-badge">
                        <i nz-icon nzType="flag" nzTheme="outline"></i>
                        {{ getPrioridadText(selectedActivity.prioridad) }}
                    </nz-tag>
                    <nz-tag [nzColor]="getActivityStatusColor(selectedActivity.estado)" class="view-badge">
                        <i nz-icon nzType="check-circle" nzTheme="outline"></i>
                        {{ getEstadoText(selectedActivity.estado) }}
                    </nz-tag>
                </div>
            </div>

            <nz-divider></nz-divider>

            <!-- Informaci√≥n principal -->
            <div class="view-info-grid">

                <!-- Descripci√≥n -->
                <div class="view-info-item" *ngIf="selectedActivity.descripcion">
                    <div class="view-info-label">
                        <i nz-icon nzType="file-text" nzTheme="outline"></i>
                        Descripci√≥n:
                    </div>
                    <div class="view-info-value">
                        {{ selectedActivity.descripcion }}
                    </div>
                </div>

                <!-- Fecha L√≠mite -->
                <div class="view-info-item">
                    <div class="view-info-label">
                        <i nz-icon nzType="calendar" nzTheme="outline"></i>
                        Fecha l√≠mite:
                    </div>
                    <div class="view-info-value">
                        {{ formatDate(selectedActivity.fechaLimite) }}
                    </div>
                </div>

                <!-- Responsable -->
                <div class="view-info-item">
                    <div class="view-info-label">
                        <i nz-icon nzType="user" nzTheme="outline"></i>
                        Responsable:
                    </div>
                    <div class="view-info-value">
                        {{ selectedActivity.responsableNombre }}
                    </div>
                </div>

                <!-- Fecha de Creaci√≥n -->
                <div class="view-info-item" *ngIf="selectedActivity.fechaCreacion">
                    <div class="view-info-label">
                        <i nz-icon nzType="clock-circle" nzTheme="outline"></i>
                        Fecha de creaci√≥n:
                    </div>
                    <div class="view-info-value">
                        {{ formatDate(selectedActivity.fechaCreacion) }}
                    </div>
                </div>

                <!-- √Årea -->
                <div class="view-info-item" *ngIf="selectedActivity.area">
                    <div class="view-info-label">
                        <i nz-icon nzType="apartment" nzTheme="outline"></i>
                        √Årea:
                    </div>
                    <div class="view-info-value">
                        {{ selectedActivity.area | uppercase }}
                    </div>
                </div>

                <!-- Notas -->
                <div class="view-info-item" *ngIf="selectedActivity.notas">
                    <div class="view-info-label">
                        <i nz-icon nzType="edit" nzTheme="outline"></i>
                        Notas:
                    </div>
                    <div class="view-info-value">
                        {{ selectedActivity.notas }}
                    </div>
                </div>

                <!-- Etiquetas -->
                <div class="view-info-item" *ngIf="selectedActivity.etiquetas && selectedActivity.etiquetas.length > 0">
                    <div class="view-info-label">
                        <i nz-icon nzType="tags" nzTheme="outline"></i>
                        Etiquetas:
                    </div>
                    <div class="view-info-value">
                        <nz-tag *ngFor="let tag of selectedActivity.etiquetas" [nzColor]="'blue'">
                            {{ tag }}
                        </nz-tag>
                    </div>
                </div>

            </div>

        </div>
    </ng-container>

    <!-- Footer personalizado con botones de acci√≥n -->
    <ng-template #viewModalFooter>
        <div class="view-modal-footer">
            <div class="view-modal-actions-left">
                <button nz-button nzType="default" (click)="editFromView()" nz-tooltip
                    nzTooltipTitle="Editar actividad">
                    <i nz-icon nzType="edit" nzTheme="outline"></i>
                    Editar
                </button>
                <button nz-button nzType="primary" *ngIf="selectedActivity && selectedActivity.estado !== 'completada'"
                    (click)="completeFromView()" nz-tooltip nzTooltipTitle="Marcar como completada">
                    <i nz-icon nzType="check-circle" nzTheme="outline"></i>
                    Completar
                </button>
                <button nz-button nzDanger nz-popconfirm nzPopconfirmTitle="¬øEst√° seguro de eliminar esta actividad?"
                    nzOkText="S√≠" nzCancelText="No" (nzOnConfirm)="deleteFromView()" nz-tooltip
                    nzTooltipTitle="Eliminar actividad">
                    <i nz-icon nzType="delete" nzTheme="outline"></i>
                    Eliminar
                </button>
            </div>
            <div class="view-modal-actions-right">
                <button nz-button nzType="default" (click)="closeViewModal()">
                    Cerrar
                </button>
            </div>
        </div>
    </ng-template>

</nz-modal>

<!-- üîç MODAL DE RESULTADOS DE B√öSQUEDA -->
<nz-modal [(nzVisible)]="showSearchResultsModal" nzTitle="Resultados de B√∫squeda" nzWidth="800px"
    (nzOnCancel)="closeSearchResultsModal()" [nzFooter]="searchModalFooter" nzCentered>

    <ng-container *nzModalContent>
        <div class="search-results-content">

            <!-- Header con estad√≠sticas -->
            <div class="search-results-header">
                <div class="search-query">
                    <i nz-icon nzType="search" nzTheme="outline"></i>
                    <span>Buscando: <strong>"{{ searchTerm }}"</strong></span>
                </div>
                <div class="search-stats">
                    <nz-tag [nzColor]="'blue'" style="font-size: 14px; padding: 4px 12px;">
                        {{ searchResultCount }} {{ searchResultCount === 1 ? 'resultado' : 'resultados' }}
                    </nz-tag>
                </div>
            </div>

            <nz-divider></nz-divider>

            <!-- Lista de resultados -->
            <div class="search-results-list">
                <div *ngFor="let activity of searchResults; trackBy: trackByActivityId" class="search-result-item"
                    (click)="viewActivityFromSearch(activity)">

                    <div class="result-badges">
                        <nz-tag [nzColor]="getPriorityColor(activity.prioridad)" class="result-badge">
                            {{ activity.prioridad | uppercase }}
                        </nz-tag>
                        <nz-tag [nzColor]="getActivityStatusColor(activity.estado)" class="result-badge">
                            {{ activity.estado }}
                        </nz-tag>
                    </div>

                    <div class="result-content">
                        <div class="result-title">{{ activity.titulo }}</div>
                        <div class="result-description" *ngIf="activity.descripcion">
                            {{ activity.descripcion }}
                        </div>
                        <div class="result-meta">
                            <span class="result-meta-item">
                                <i nz-icon nzType="user" nzTheme="outline"></i>
                                {{ activity.responsableNombre }}
                            </span>
                            <span class="result-meta-item">
                                <i nz-icon nzType="calendar" nzTheme="outline"></i>
                                {{ activity.fechaLimite | date:'dd/MM/yyyy' }}
                            </span>
                        </div>
                    </div>

                    <div class="result-actions">
                        <button nz-button nzType="text" nzSize="small"
                            (click)="$event.stopPropagation(); viewActivityFromSearch(activity)" nz-tooltip
                            nzTooltipTitle="Ver detalles">
                            <i nz-icon nzType="eye" nzTheme="outline"></i>
                        </button>
                        <button nz-button nzType="text" nzSize="small"
                            (click)="$event.stopPropagation(); editActivityFromSearch(activity)" nz-tooltip
                            nzTooltipTitle="Editar">
                            <i nz-icon nzType="edit" nzTheme="outline"></i>
                        </button>
                    </div>
                </div>

                <!-- Sin resultados -->
                <div *ngIf="searchResultCount === 0" class="no-search-results">
                    <i nz-icon nzType="inbox" nzTheme="outline"></i>
                    <h3>No se encontraron resultados</h3>
                    <p>Intenta con otros t√©rminos de b√∫squeda</p>
                </div>
            </div>

        </div>
    </ng-container>

    <!-- Footer del modal -->
    <ng-template #searchModalFooter>
        <button nz-button nzType="default" (click)="closeSearchResultsModal()">
            Cerrar
        </button>
    </ng-template>

</nz-modal>